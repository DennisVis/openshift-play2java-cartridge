#!/bin/bash

STOPTIMEOUT=10
FMT="%a %b %d %Y %H:%M:%S GMT%z (%Z)"

function is_play_service_running() {
    if [ -f ${OPENSHIFT_REPO_DIR}RUNNING_PID ]; then
        play_pid=$( cat ${OPENSHIFT_REPO_DIR}RUNNING_PID 2> /dev/null )
        if `ps --pid $play_pid 2>&1`; then
            return 0
        fi
    fi

    return 1
}

function status() {
    if is_play_service_running; then
        client_result "Application is running"
    else
        client_result "Application is not running"
    fi
}


function start() {
    ${OPENSHIFT_PLAY2JAVA_DIR}.openshift/action_hooks/start
}

function stop() {
    ${OPENSHIFT_PLAY2JAVA_DIR}.openshift/action_hooks/stop
}

function restart() {
    stop
    start
}

function tidy() {
  client_message "Emptying log dir: $OPENSHIFT_PLAY2JAVA_LOG_DIR"
  shopt -s dotglob
  rm -rf ${OPENSHIFT_PLAY2JAVA_DIR}logs/*
  rm -rf ${OPENSHIFT_PLAY2JAVA_DIR}tmp/*
}

#
#  main():
#

# Ensure arguments.
if ! [ $# -eq 1 ]; then
    echo "Usage: $0 [start|restart|stop|status|tidy]"
    exit 1
fi

# Source utility functions.
source $OPENSHIFT_CARTRIDGE_SDK_BASH

# Handle commands.
case "$1" in
    start)               start       ;;
    restart)    	 restart     ;;
    stop)  		 stop        ;;
    status)              status      ;;
    tidy)                tidy        ;;
    *) exit 0;
esac

